# Chapter 6: Navigation & SLAM - ROS 2 Nav2 Setup Guide
### 6.4.1 Guide to Setting Up the Nav2 Stack in ROS 2
The Nav2 stack in ROS 2 provides a powerful framework for robot navigation, including capabilities for localization, mapping, path planning, and motion control. This guide outlines the steps to set up Nav2 for a simulated Turtlebot3 robot.
**1. Install Nav2 and Turtlebot3 Packages:**
Begin by installing the necessary ROS 2 packages for Nav2 and Turtlebot3.
```bash
sudo apt install ros-humble-navigation2 ros-humble-nav2-bringup
sudo apt install ros-humble-turtlebot3\*
```
    
    **2. Set Robot Model:**
    Configure the `TURTLEBOT3_MODEL` environment variable in your `.bashrc` file to specify the Turtlebot3 model being used (e.g., `waffle`).
    ```bash
    export TURTLEBOT3_MODEL=waffle
    ```
    **3. Launch Simulated Robot in Gazebo:**
    Start a simulated Turtlebot3 robot in a Gazebo environment.
    ```bash
    ros2 launch turtlebot3_gazebo turtlebot3_world.launch.py
    ```
    **4. Generate a Map using SLAM (Cartographer):**
    To create a map of the environment, launch the Cartographer SLAM node, ensuring `use_sim_time:=True` for simulation.
    ```bash
    ros2 launch turtlebot3_cartographer cartographer.launch.py use_sim_time:=True
    ```
    Drive the robot around the environment using a teleoperation node (e.g., `ros2 run turtlebot3_teleop teleop_keyboard`). Once the map is sufficiently built, save it:
    ```bash
    ros2 run nav2_map_server map_saver_cli -f my_map
    ```
    This command will create two files: `my_map.yaml` (containing metadata like resolution and origin) and `my_map.pgm` (the occupancy grid image).
    **5. Configure DDS and Turtlebot3 Navigation Parameters:**
    *   **Install Cyclone DDS:** Cyclone DDS is often preferred for performance with Nav2.
        ```bash
        sudo apt install ros-humble-rmw-cyclonedds-cpp
        ```
    *   **Set RMW Implementation:** Add the following line to your `.bashrc` to configure ROS 2 to use Cyclone DDS:
        ```bash
        export RMW_IMPLEMENTATION=rmw_cyclonedds_cpp
        ```
    *   **Modify Turtlebot3 Navigation Parameters:** Edit the `waffle.yaml` file (typically found at `/opt/ros/humble/share/turtlebot3_navigation2/param/waffle.yaml`) to set the `robot_model_type`.
        ```yaml
        robot_model_type: "nav2_amcl::DifferentialMotionModel"
        ```
    
    **6. Launch Nav2 for Navigation:**
    With the map generated and configurations set, launch the Nav2 stack, specifying the path to your saved map.
    ```bash
    ros2 launch turtlebot3_navigation2 navigation2.launch.py use_sim_time:=True map:=/path/to/my_map.yaml
    ```
    In RViz, use the "2D Pose Estimate" tool to initialize the robot's position and orientation on the map. Then, use the "Nav2 Goal" tool to set navigation targets for the robot.