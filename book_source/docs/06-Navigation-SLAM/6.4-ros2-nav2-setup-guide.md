     1→# Chapter 6: Navigation & SLAM - ROS 2 Nav2 Setup Guide
     2→
     3→### 6.4.1 Guide to Setting Up the Nav2 Stack in ROS 2
     4→
     5→The Nav2 stack in ROS 2 provides a powerful framework for robot navigation, including capabilities for localization, mapping, path planning, and motion control. This guide outlines the steps to set up Nav2 for a simulated Turtlebot3 robot.
     6→
     7→**1. Install Nav2 and Turtlebot3 Packages:**
     8→Begin by installing the necessary ROS 2 packages for Nav2 and Turtlebot3.
     9→```bash
    10→sudo apt install ros-humble-navigation2 ros-humble-nav2-bringup
    11→sudo apt install ros-humble-turtlebot3\*
    12→```
    13→
    14→**2. Set Robot Model:**
    15→Configure the `TURTLEBOT3_MODEL` environment variable in your `.bashrc` file to specify the Turtlebot3 model being used (e.g., `waffle`).
    16→```bash
    17→export TURTLEBOT3_MODEL=waffle
    18→```
    19→
    20→**3. Launch Simulated Robot in Gazebo:**
    21→Start a simulated Turtlebot3 robot in a Gazebo environment.
    22→```bash
    23→ros2 launch turtlebot3_gazebo turtlebot3_world.launch.py
    24→```
    25→
    26→**4. Generate a Map using SLAM (Cartographer):**
    27→To create a map of the environment, launch the Cartographer SLAM node, ensuring `use_sim_time:=True` for simulation.
    28→```bash
    29→ros2 launch turtlebot3_cartographer cartographer.launch.py use_sim_time:=True
    30→```
    31→Drive the robot around the environment using a teleoperation node (e.g., `ros2 run turtlebot3_teleop teleop_keyboard`). Once the map is sufficiently built, save it:
    32→```bash
    33→ros2 run nav2_map_server map_saver_cli -f my_map
    34→```
    35→This command will create two files: `my_map.yaml` (containing metadata like resolution and origin) and `my_map.pgm` (the occupancy grid image).
    36→
    37→**5. Configure DDS and Turtlebot3 Navigation Parameters:**
    38→*   **Install Cyclone DDS:** Cyclone DDS is often preferred for performance with Nav2.
    39→    ```bash
    40→    sudo apt install ros-humble-rmw-cyclonedds-cpp
    41→    ```
    42→*   **Set RMW Implementation:** Add the following line to your `.bashrc` to configure ROS 2 to use Cyclone DDS:
    43→    ```bash
    44→    export RMW_IMPLEMENTATION=rmw_cyclonedds_cpp
    45→    ```
    46→*   **Modify Turtlebot3 Navigation Parameters:** Edit the `waffle.yaml` file (typically found at `/opt/ros/humble/share/turtlebot3_navigation2/param/waffle.yaml`) to set the `robot_model_type`.
    47→    ```yaml
    48→    robot_model_type: "nav2_amcl::DifferentialMotionModel"
    49→    ```
    50→
    51→**6. Launch Nav2 for Navigation:**
    52→With the map generated and configurations set, launch the Nav2 stack, specifying the path to your saved map.
    53→```bash
    54→ros2 launch turtlebot3_navigation2 navigation2.launch.py use_sim_time:=True map:=/path/to/my_map.yaml
    55→```
    56→In RViz, use the "2D Pose Estimate" tool to initialize the robot's position and orientation on the map. Then, use the "Nav2 Goal" tool to set navigation targets for the robot.
    57→